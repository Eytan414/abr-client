<main>
    <form #addQuizForm="ngForm" (ngSubmit)="onSubmit(addQuizForm)">
        <div class="form-control-wrapper">
            <label>שם חידון
                <input type="text" name="quizName" [(ngModel)]="newQuiz.title" required placeholder="שם חידון" />
            </label>
        </div>

        <div class="question-wrapper form-control-wrapper">
            <label>הוספת שאלה
                <button type="button" (click)="addQuestion()">הוספה</button>
            </label>

            @for(question of newQuiz.questions; track $index) {
            @let questionIndex = $index + 1;
            <div class="question">
                <div class="question-title">
                    <button class="remove" type="button" (click)="deleteQuestion($index)">
                        <mat-icon>remove</mat-icon>
                    </button>
                    <label>שאלה {{questionIndex}}
                        <input type="text" name="title_{{questionIndex}}" [(ngModel)]="question.title" required
                            placeholder="שאלה {{questionIndex}}" />
                    </label>
                    <div class="attach">
                        <input type="file" (change)="onFile($event)" name="file" accept="video/*,image/*">
                        <button type="button" (click)="upload($index)">העלאה</button>
                        @if(loading()){
                        <mat-spinner></mat-spinner>
                        }
                        @if(fileSubmitionStatus() === 200){
                        <mat-icon>check</mat-icon>
                        } @else if(fileSubmitionStatus() !== -1){
                        <mat-icon>close</mat-icon>
                        }
                    </div>
                </div>
                <div class="question-possible-answers">
                    @for(answer of question.possible_answers; track $index) {
                    @let answerIndex = $index + 1;

                    <span class="answer-and-radio">
                        <input type="radio" name="correctAnswer_{{questionIndex}}" required
                            [(ngModel)]="newQuiz.answers[questionIndex - 1]" [value]="answer.id" />
                        <input type="text" name="answer_{{questionIndex}}_{{answerIndex}}" [(ngModel)]="answer.value"
                            required placeholder="תשובה {{answerIndex}}" />
                    </span>
                    }
                </div>
            </div>
            @if(!$last){
            <hr />
            }
            }
        </div>
        <button type="submit" [disabled]="addQuizForm.invalid || newQuiz.questions.length < 1">שמירת חידון</button>

        @if(submitionStatus() === 200){
        <c-alert visible="true" dismissible="true" color="success" fade>
            החידון נוסף בהצלחה
        </c-alert>
        }
        @else if(submitionStatus() !== -1){
        <c-alert visible="true" dismissible="true" color="danger" fade>
            חלה תקלה, יש לנסות שוב, אם הבעיה ממשיכה נא לפנות לתמיכה
        </c-alert>
        }
    </form>

</main>